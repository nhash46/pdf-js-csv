/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */

//
// See README for overview
//

'use strict';

//
// Fetch the PDF document from the URL using promises
//
function parsePDF() {
  var pages = [];

  PDFJS.getDocument('../examples/tests.pdf').then(function(pdf) {
    var page_num = 1;
    var canvases = [];
    
    console.log("Pages: " + pdf.pdfInfo.numPages);
    for (var i = 0; i < pdf.pdfInfo.numPages; i++) {
      var canvas = document.createElement('canvas');
      canvas.id = 'the-canvas' + i;
      document.body.appendChild(canvas);  
      canvases[i] = canvas;
      pages[i] = [];
      console.log("Pages of data (2): " + pages.length);
    }  

       
    console.log("Parsing pages(2): " + pdf.pdfInfo.numPages);
    for (var page_num = 1; page_num < pdf.pdfInfo.numPages + 1; page_num++) {
      console.log("Drawing " + page_num);
      recordPage(page_num);
    }
  
    function recordPage(idx) {
    pdf.getPage(idx).then(function(page) {
      var scale = 1.5;
      var viewport = page.getViewport(scale);

      var canvas = document.getElementById('the-canvas');
      var context = canvas.getContext('2d');
      canvas.height = viewport.height;
      canvas.width = viewport.width;

      var renderContext = {
        canvasContext: context,
        viewport: viewport
      };
      page.render(renderContext);
    });
    }
  });
}

parsePDF();

